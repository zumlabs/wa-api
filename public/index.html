<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp API - ZumLabs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .status-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .status-item h3 {
            margin-bottom: 10px;
            color: #495057;
        }
        
        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            color: white;
        }
        
        .status-ready { background-color: #28a745; }
        .status-qr_code { background-color: #ffc107; color: #000; }
        .status-disconnected { background-color: #dc3545; }
        .status-error { background-color: #dc3545; }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }
        
        .qr-container {
            text-align: center;
            padding: 20px;
        }
        
        #qrCode {
            max-width: 300px;
            max-height: 300px;
        }
        
        .response {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #667eea;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 20px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ WhatsApp API</h1>
            <p>Professional WhatsApp Web API by ZumLabs</p>
        </div>

        <!-- Status Section -->
        <div class="card">
            <h2>üìä System Status</h2>
            <div class="status-card" id="statusContainer">
                <div class="status-item">
                    <h3>Connection Status</h3>
                    <span class="status-badge status-disconnected" id="connectionStatus">Loading...</span>
                </div>
                <div class="status-item">
                    <h3>Client Ready</h3>
                    <span class="status-badge status-disconnected" id="readyStatus">No</span>
                </div>
                <div class="status-item">
                    <h3>Last Updated</h3>
                    <span id="lastUpdated">Never</span>
                </div>
            </div>
            <button class="btn btn-info" onclick="checkStatus()">üîÑ Refresh Status</button>
            <button class="btn" onclick="getQRCode()">üì± Show QR Code</button>
            <button class="btn btn-danger" onclick="logout()">üö™ Logout</button>
        </div>

        <div class="grid">
            <!-- QR Code Section -->
            <div class="card">
                <h2>üì± QR Code</h2>
                <div class="qr-container">
                    <div id="qrContainer" style="display: none;">
                        <p>Scan this QR code with WhatsApp:</p>
                        <img id="qrCode" alt="QR Code">
                    </div>
                    <div id="qrMessage">
                        <p>Click "Show QR Code" to display QR code for authentication.</p>
                    </div>
                </div>
            </div>

            <!-- Send Message Section -->
            <div class="card">
                <h2>üí¨ Send Message</h2>
                <form onsubmit="sendMessage(event)">
                    <div class="form-group">
                        <label for="phoneNumber">Phone Number:</label>
                        <input type="text" id="phoneNumber" placeholder="628123456789 or 628123456789@c.us" required>
                        <small>Format: 628123456789 (without + and spaces)</small>
                    </div>
                    <div class="form-group">
                        <label for="message">Message:</label>
                        <textarea id="message" rows="4" placeholder="Enter your message here..." required></textarea>
                    </div>
                    <button type="submit" class="btn">üì§ Send Message</button>
                </form>
            </div>
        </div>

        <!-- Response Section -->
        <div class="card">
            <h2>üìã API Response</h2>
            <div class="loading" id="loading">‚è≥ Processing...</div>
            <div class="response" id="response">Ready to use the API...</div>
        </div>

        <!-- API Documentation -->
        <div class="card">
            <h2>üìö API Documentation</h2>
            <h3>Available Endpoints:</h3>
            <ul>
                <li><strong>GET /api/status</strong> - Check WhatsApp connection status</li>
                <li><strong>GET /api/qr</strong> - Get QR code for authentication</li>
                <li><strong>POST /api/send-message</strong> - Send a message</li>
                <li><strong>POST /api/logout</strong> - Logout from WhatsApp</li>
                <li><strong>GET /health</strong> - Server health check</li>
            </ul>
            
            <h3>Example Usage:</h3>
            <div class="response">
POST /api/send-message
Content-Type: application/json

{
    "number": "628123456789",
    "message": "Hello from WhatsApp API!"
}
            </div>
        </div>
    </div>

    <script>
        let refreshInterval;

        // Auto-refresh status every 5 seconds
        function startAutoRefresh() {
            refreshInterval = setInterval(checkStatus, 5000);
        }

        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        }

        async function makeRequest(url, options = {}) {
            const loading = document.getElementById('loading');
            const response = document.getElementById('response');
            
            loading.style.display = 'block';
            
            try {
                const res = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                const data = await res.json();
                response.textContent = JSON.stringify(data, null, 2);
                return data;
            } catch (error) {
                response.textContent = `Error: ${error.message}`;
                throw error;
            } finally {
                loading.style.display = 'none';
            }
        }

        async function checkStatus() {
            try {
                const data = await makeRequest('/api/status');
                updateStatusDisplay(data);
            } catch (error) {
                console.error('Failed to check status:', error);
            }
        }

        function updateStatusDisplay(data) {
            const connectionStatus = document.getElementById('connectionStatus');
            const readyStatus = document.getElementById('readyStatus');
            const lastUpdated = document.getElementById('lastUpdated');
            
            if (data.success) {
                connectionStatus.textContent = data.status;
                connectionStatus.className = `status-badge status-${data.status}`;
                
                readyStatus.textContent = data.isReady ? 'Yes' : 'No';
                readyStatus.className = `status-badge ${data.isReady ? 'status-ready' : 'status-disconnected'}`;
                
                lastUpdated.textContent = new Date(data.timestamp).toLocaleString();
            } else {
                connectionStatus.textContent = 'Error';
                connectionStatus.className = 'status-badge status-error';
            }
        }

        async function getQRCode() {
            try {
                const data = await makeRequest('/api/qr');
                
                if (data.success && data.qr) {
                    document.getElementById('qrCode').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(data.qr)}`;
                    document.getElementById('qrContainer').style.display = 'block';
                    document.getElementById('qrMessage').style.display = 'none';
                } else {
                    document.getElementById('qrContainer').style.display = 'none';
                    document.getElementById('qrMessage').innerHTML = `<p>${data.message || 'No QR code available'}</p>`;
                    document.getElementById('qrMessage').style.display = 'block';
                }
            } catch (error) {
                console.error('Failed to get QR code:', error);
            }
        }

        async function sendMessage(event) {
            event.preventDefault();
            
            const number = document.getElementById('phoneNumber').value;
            const message = document.getElementById('message').value;
            
            try {
                await makeRequest('/api/send-message', {
                    method: 'POST',
                    body: JSON.stringify({ number, message })
                });
            } catch (error) {
                console.error('Failed to send message:', error);
            }
        }

        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await makeRequest('/api/logout', { method: 'POST' });
                    // Hide QR code after logout
                    document.getElementById('qrContainer').style.display = 'none';
                    document.getElementById('qrMessage').innerHTML = '<p>Logged out. Click "Show QR Code" to authenticate again.</p>';
                    document.getElementById('qrMessage').style.display = 'block';
                } catch (error) {
                    console.error('Failed to logout:', error);
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkStatus();
            startAutoRefresh();
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            stopAutoRefresh();
        });
    </script>
</body>
</html>